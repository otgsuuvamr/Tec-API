<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Meu Perfil</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-blue-100 text-gray-800 font-sans">
    <!-- üîπ Navbar -->
    <nav
      class="fixed top-0 left-0 right-0 bg-white shadow-md px-6 py-3 flex justify-between items-center z-50"
    >
    <a href="../product.html"><h1 class="text-xl font-bold text-blue-600">LojaTec</h1></a>
      <div class="flex items-center gap-6">
        <!-- √çcone de perfil -->
        <a
          href="profile.html"
          class="text-gray-700 hover:text-blue-600"
          title="Meu Perfil"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-7 h-7"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5.121 17.804A9 9 0 1118.879 6.196M15 11a3 3 0 11-6 0 3 3 0 016 0z"
            />
          </svg>
        </a>
        <!-- Bot√£o sair -->
        <button
          onclick="logout()"
          class="text-red-600 hover:text-red-800 font-semibold"
        >
          Sair
        </button>
      </div>
    </nav>

    <!-- üîπ Conte√∫do principal -->
    <div class="max-w-xl mx-auto mt-28 p-6 bg-white shadow-md rounded-lg">
      <h2 class="text-2xl font-bold mb-6 text-center">üë§ Meu Perfil</h2>

      <!-- Nome -->
      <div class="mb-6">
        <label class="block font-semibold mb-1">Nome:</label>
        <div class="flex gap-2">
          <input id="name" class="input flex-1" />
          <button onclick="updateName()" class="btn bg-green-500">
            Atualizar
          </button>
        </div>
      </div>

      <!-- E-mail -->
      <div class="mb-6">
        <label class="block font-semibold mb-1">E-mail:</label>
        <input id="email" class="input bg-gray-100 w-full" disabled />
      </div>

      <!-- A√ß√µes -->
      <div class="space-y-3">
        <a href="updatePass.html" class="btn bg-yellow-500 block text-center"
          >üîê Alterar Senha</a
        >
        <a href="updateEmail.html" class="btn bg-purple-500 block text-center"
          >üìß Alterar E-mail</a
        >
        <a href="deleteAcc.html" class="btn bg-red-600 block text-center"
          >‚ùå Excluir Conta</a
        >
      </div>
    </div>

    <!-- üîπ Estilos globais -->
    <style>
      .input {
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 0.375rem;
      }
      .btn {
        padding: 0.5rem 1rem;
        color: white;
        border: none;
        border-radius: 0.375rem;
        cursor: pointer;
        text-decoration: none;
      }
    </style>

    <!-- üîπ Scripts -->
    <script>
      const API = "http://localhost:3000/auth";

      const headers = () => ({
        "Content-Type": "application/json",
        Authorization: `Bearer ${localStorage.getItem("token")}`,
      });

      function logout() {
        localStorage.removeItem("token");
        window.location.href = "index.html";
      }

      function loadProfile() {
        fetch(`${API}/me`, { headers: headers() })
          .then((res) => res.json())
          .then((data) => {
            // ajuste para acessar user corretamente
            const user = data.user || data;
            document.getElementById("name").value = user.name;
            document.getElementById("email").value = user.email;
          });
      }

      function updateName() {
        const name = document.getElementById("name").value;

        if (!name || name.trim().length < 2) {
          alert("‚ùå O nome deve ter pelo menos 2 caracteres.");
          return;
        }

        fetch(`${API}/me`, {
          method: "PUT",
          headers: headers(),
          body: JSON.stringify({ name }),
        })
          .then((res) => res.json())
          .then((data) => {
            alert(data.message || "Nome atualizado!");
            loadProfile();
          });
      }

      // Carrega os dados ao entrar
      loadProfile();
    </script>
  </body>
</html>
