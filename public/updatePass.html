<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Alterar Senha</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-blue-100 flex justify-center items-center min-h-screen">
    <!-- üîπ Navbar -->
    <nav
      class="fixed top-0 left-0 right-0 bg-white shadow-md p-4 flex justify-between items-center z-50"
    >
      <a href="../product.html"><h1 class="text-xl font-bold text-blue-600">LojaTec</h1></a>
      <div class="flex items-center gap-4">
        <a
          href="profile.html"
          class="text-gray-700 hover:text-blue-600"
          title="Meu Perfil"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-7 h-7"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M5.121 17.804A9 9 0 1118.879 6.196M15 11a3 3 0 11-6 0 3 3 0 016 0z"
            />
          </svg>
        </a>
        <button
          onclick="logout()"
          class="text-red-600 hover:text-red-800 font-semibold"
        >
          Sair
        </button>
      </div>
    </nav>

    <!-- üîπ Conte√∫do -->
    <div class="bg-white p-6 rounded shadow-md w-96 mt-28">
      <h1 class="text-xl font-bold mb-4 text-center">üîê Alterar Senha</h1>

      <input
        id="currentPass"
        type="password"
        placeholder="Senha atual"
        class="input mb-3"
      />
      <input
        id="newPass"
        type="password"
        placeholder="Nova senha"
        class="input mb-3"
      />
      <input
        id="confNewPass"
        type="password"
        placeholder="Confirme nova senha"
        class="input mb-3"
      />

      <button onclick="updatePass()" class="btn bg-yellow-600 w-full">
        Salvar
      </button>

      <!-- üîπ status din√¢mico -->
      <p id="status" class="text-sm text-center mt-3 font-semibold"></p>
    </div>

    <style>
      .input {
        width: 100%;
        padding: 0.5rem;
        border: 1px solid #ccc;
        border-radius: 0.375rem;
      }
      .btn {
        padding: 0.5rem;
        color: white;
        border: none;
        border-radius: 0.375rem;
        cursor: pointer;
      }
    </style>

    <script>
      const API = "http://localhost:3000/auth/me/password";
      const token = localStorage.getItem("token");

      function logout() {
        localStorage.removeItem("token");
        window.location.href = "index.html";
      }

      async function updatePass() {
        const currentPass = document.getElementById("currentPass").value;
        const newPass = document.getElementById("newPass").value;
        const confNewPass = document.getElementById("confNewPass").value;

        const res = await fetch(API, {
          method: "PUT",
          headers: {
            "Content-Type": "application/json",
            Authorization: "Bearer " + token,
          },
          body: JSON.stringify({ currentPass, newPass, confNewPass }),
        });

        const data = await res.json();
        const statusEl = document.getElementById("status");

        if (res.ok) {
          statusEl.textContent = data.message || "Senha alterada com sucesso!";
          statusEl.className =
            "text-sm text-center mt-3 font-semibold text-green-600";
        } else {
          statusEl.textContent = data.error || "Erro ao alterar senha.";
          statusEl.className =
            "text-sm text-center mt-3 font-semibold text-red-600";
        }
      }
    </script>
  </body>
</html>
